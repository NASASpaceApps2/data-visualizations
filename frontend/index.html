<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      overflow-x: hidden;
    }

    h2 {
      font-size: 24px !important
    }

    .custom-select {
      width: 200px;
    }

    .custom-select:focus {
      border-color: #80bdff;
      outline: 0;
      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 8px rgba(102, 175, 233, .6);
      box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 8px rgba(102, 175, 233, .6);
    }

    .custom-select {
      display: inline-block;
      width: 100%;
      height: calc(2.25rem + 2px);
      padding: .375rem 1.75rem .375rem .75rem;
      line-height: 1.5;
      color: #495057;
      vertical-align: middle;
      background: #fff url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'%3E%3Cpath fill='%23343a40' d='M2 0L0 2h4zm0 5L0 3h4z'/%3E%3C/svg%3E") no-repeat right .75rem center;
      background-size: 8px 10px;
      border: 1px solid #ced4da;
      border-radius: .25rem;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }

    .custom-select:focus::-ms-value {
      color: #495057;
      background-color: #fff;
    }

    .custom-select:focus::-ms-value {
      color: #495057;
      background-color: #fff;
    }

    .custom-select:focus::-ms-value {
      color: #495057;
      background-color: #fff;
    }

    .custom-select:focus::-ms-value {
      color: #495057;
    }

    .dropbtn {
      background-color: rgb(21, 70, 226);
      color: white;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
    }

    .dropdown {
      position: relative;
      display: inline-block;
      width: 300px;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f1f1f1;
      min-width: 160px;
      box-shadow: 0px 8px 16px 0px rgba(150, 110, 110, 0.2);
      z-index: 1;
      font-style: italic;
    }

    .dropdown-content a {
      color: black;
      padding: 6px 8px;
      text-decoration: none;
      display: block;
    }

    .dropdown-content a:hover {
      background-color: #ddd;
    }

    .dropdown:hover .dropdown-content {
      z-index: 10;
      display: block;
    }

    .dropdown:hover .dropbtn {
      background-color: rgb(31, 80, 236);

    }

    .highlight {
      background-color: rgb(244, 255, 83);
    }
    .card-header a {
      color: darkslategray
    }
    .card-header a:hover {
      color: black
    }
  </style>
  <!-- Use bootstrap 5 -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
    integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>

</head>

<body>
  <!-- Context menu with breadcrumbs pinned to top edge of screen -->
  <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom shadow-sm">
    <h5 class="my-0 mr-md-auto font-weight-normal">NASA Dataset Explorer</h5>
    <nav class="my-2 my-md-0 mr-md-3">
      Quick links:
      <a class="p-2 text-dark" href="#" onclick="about()">About</a>
      <a class="p-2 text-dark" href="#" onclick="dataSources()">Data Sources</a>
      <a class="p-2 text-dark" href="https://github.com/NASASpaceApps2/data-visualizations">GitHub Repository</a>
      <a class="p-2 text-dark" href="https://data.nasa.gov/data_visualizations.html">NASA Data Visualization</a>
      <a class="p-2 text-dark" href="https://data.nasa.gov/browse">NASA Dataset Catalog</a>
      <a class="p-2 text-dark" href="https://github.com/nasa/api-docs">NASA API Docs</a>
      <a class="p-2 text-dark"
        href="https://2021.spaceappschallenge.org/challenges/statements/ontologies-and-interactive-network-visualizations/teams/runtime-terror-1/project">NASA
        Space Apps Team Info</a>
    </nav>
  </div>


  <div class="container">
    <div class="row col-md-8 col-sm-12 mt-5">
      <h2>Dropdown Menu</h2>
      <p>Select a source to view all datasets from that data center.</p>
      <div class="dropdown">
        <button class="dropbtn">Sources</button>
        <div class="dropdown-content">
          <a href="sources/Alaka Satellite Facility.html">Alaka Satellite Facility</a>
          <a href="sources/Atmospherical Science Data Center.html">Atmospherical Science Data Center</a>
          <a href="sources/Crustal Dynamics Data Information System.html">Crustal Dynamics Data Information System</a>
          <a href="sources/Distributed Archive Center.html">Distributed Archive Center</a>
          <a href="sources/Earth Resources Observation And Science Center.html">Earth Resources Observation And Science Center</a>
          <a href="sources/Land Processes Distributed Data Center.html">Land Processes Distributed Data Center</a>
          <a href="sources/Nasa Goddard Global Change Data Center.html">Nasa Goddard Global Change Data Center</a>
          <a href="sources/Nasa Langley Atmospherical Sciences Data Center.html">Nasa Langley Atmospherical Sciences Data Center</a>
          <a href="sources/Nasa Langley Research Center.html">Nasa Langley Research Center</a>
          <a href="sources/Nasa’s Oak Ridge National Lab Data Center.html">Nasa’s Oak Ridge National Lab Data Center</a>
          <a href="sources/National Aeronautics And Space Administration.html">National Aeronautics And Space Administration</a>
          <a href="sources/National Snow And Ice Data Center.html">National Snow And Ice Data Center</a>
          <a href="sources/Not Provided.html">Not Provided</a>
          <a href="sources/Ocean Biology Data Center.html">Ocean Biology Data Center</a>
          <a href="sources/Physical Oceanography Distributed Active Archive Center.html">Physical Oceanography Distributed Active Archive Center</a>
          <a href="sources/Social Economic Data And Applications Center.html">Social Economic Data and Applications Center</a>
          
        </div>
        
      <br>


    </div>
    <div class="row col-md-8 col-sm-12 mt-2">
      <h2 class="mt-4">Dataset Tree</h2>
      <p>The following shows NASA public datasets arranged as a tree hierarchy to find relevant data quickly. The tree is organized by 3 levels: Source, Category, and Keyword. Click a node to expand or collapse. Click text to view matching databases from NASA's data catalog.</p>

        <a href="#!" id="expand-all">expand all</a>
        <a href="#!" id="collapse-all">collapse all</a>
      </p>
    </div>
  </div>
  <div id="container"></div>

  <div class="container mt-4">

    <div class="row col-md-8 col-sm-12 mt-5">
      <h2>Real-time Search Tool</h2>
      <p>Search 43,000+ NASA databases in real-time. Word matches are highlighted. You can search by a different field (title, description, publisher, keywords, tags) and increase the number of results displayed at once.</p>
      <!-- Search box with dropdown menu with options acending or decending-->
      <div class="input-group mb-3">
        <input autocomplete="off" type="text" class="form-control" placeholder="e.g. Earth" aria-label="Search"
          aria-describedby="basic-addon2" id="search-input" onkeyup="onTyped()">
        <div class="input-group-append">
          <select class="custom-select" id="inputGroupSelect01" onchange="onTyped(true)">
            <option selected value="title">Title</option>
            <option value="description">Description</option>
            <option value="publisher">Publisher</option>
            <option value="theme">Themes</option>
            <option value="keyword">Keywords</option>
          </select>
        </div>
        <div class="input-group-append">
          <select class="custom-select" id="inputGroupSelect02" onchange="onTyped(true)">
            <option selected value="5">5</option>
            <option value="10">10</option>
            <option value="10">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="200">200</option>
          </select>
        </div>
        
      </div>

      <div id="showing" style="display: none;">
        <h4>Results</h4>
        <p>Showing <span id="results-limit"></span> of <span id="results-total"></span></p>
        <div id="results">
        </div>
      </div>


    </div>

  </div>

  <hr />
  <div class="container">
    <span>Created by team
      <a href="https://2021.spaceappschallenge.org/challenges/statements/ontologies-and-interactive-network-visualizations/teams/runtime-terror-1/project">Runtime Terror</a>
    </span>
    <br><br>
  </div>

</body>
<!-- d3.js -->
<script src="https://d3js.org/d3.v6.min.js"></script>
<script src="d3script.js"></script>

<!-- Search tool -->
<script>

  function highlight(text, search) {
    if (!search) return text;
    return text.replace(new RegExp(search, 'gi'), function (match) {
      return '<span class="highlight">' + match + '</span>';
    });
  }

  function compressTo200CharactersAndHighlight(html, value) {
    let randomId = Math.random().toString(36).substring(2, 15)
    outHtml = highlight(html.slice(0, 200))
    if (html.length > 200) {
      outHtml += `<a href="#!" onclick="
      document.getElementById('${randomId}').style.display='inline';this.parentNode.removeChild(this);
    ">...</a><span id="${randomId}" style="display:none">${highlight(html.slice(200), value)}</span>`
    }
    return outHtml
  }


  var blocking = false
  var lastValue = 0
  async function onTyped(forceUpdate) {
    value = document.querySelector('#search-input').value.trim()
    if (value == "") {
      document.querySelector("#showing").style.display = "none"
      document.querySelector("#results").innerHTML = ""
      return
    }
    if (!forceUpdate) {
      if (value == lastValue) {
        // If nothing changed in box (e.g. a space added)
        return
      }
      lastValue = value
      if (blocking) {
        // If user is typing too fast
        return
      }
    }
    document.querySelector("#showing").style.display = "block"
    let limit = parseInt(document.getElementById('inputGroupSelect02').value) || 10
    let option = document.getElementById("inputGroupSelect01").value;

    // Fetch the data from the API
    let baseUrl = "https://nasadata.herokuapp.com/"
    let route = `search?query=${value}&property=${option}&limit=${limit}`
    let url = baseUrl + route;
    let res = await fetch(url);
    blocking = true
    let data = await res.json();
    addCards(data);
    blocking = false
  }

  function addCards(data) {
    var cardList = document.querySelector("#results");
    var cardListHtml = ""
    document.querySelector("#results-limit").innerHTML = Math.min(data.total, data.limit);
    document.querySelector("#results-total").innerHTML = data.total;

    for (d of data.data) {

      let themeHtml = d.theme.map(function (t) {
        return `<a href="#!" onclick='alert("${t}")'>${highlight(t, value)}</a>`;
      }).join(", ");
      let tagsHtml = d.keyword.map(function (t) {
        return `<a href="#!" onclick='alert("${t}")'>${highlight(t, value)}</a>`;
      }).join(", ");


      cardListHtml += `<div class="card mb-4 shadow-sm">
          <div class="card-header">
            <h4 class="my-0 font-weight-normal"><a href=${d.landingPage}>${highlight(d.title, value)}</a></h4>
          </div>
          <div class="card-body">
            <span>${compressTo200CharactersAndHighlight(d.description, value)}</span>
            ${themeHtml.length ? `<br><span>Theme: ${themeHtml}</span>` : ""}
            <small class="float-right text-muted">
              Issued <span>${d.issued.slice(0, 10)}</span><br>
              Last updated <span>${d.modified.slice(0, 10)}</span>
            </small>
            ${tagsHtml.length ? `<br><span>Tags: ${tagsHtml}</span>` : ""}
          </div>
        </div>`;
    }

    cardList.innerHTML = cardListHtml

  }

  function about() {
    alert("Originally created for NASA Space Apps Challenge 2021, this website provides 3 tools to quickly find and navigate through NASA's collection of public databases.")
  }

  function dataSources() {
    alert("This website uses the NASA Open Data API to fetch data from NASA's public databases. The data is available for download at https://data.nasa.gov/")
  }

</script>

</html>